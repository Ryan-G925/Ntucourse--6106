<head>
    <meta name=""viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>

    <div class="container">
    
        <h2>Transfer Money</h2>
        <input type="text" id="payer" placeholder="Payer Address">
        <input type="text" id="payee" placeholder="Payee Address">
        <input type="number" id="amount" placeholder="Amount to Transfer">
        <button class="btn" onclick="Transfer()">Transfer</button>
        <button class="btn" onclick="View_Transaction()">View_Transaction</button>

        <form action ="/main" method="post">
            <input type="submit"value="Main">
        </form>
        <p id="view_payer"></p>
        <p id="view_payee"></p>
        <p id="view_amount"></p>
        
        <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>

        <script>
            const contractAddress="0xA3f588B2604B2e3546DfAae06743aA3b647A359F";
            const contractABI=[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "payer_input",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "payee_input",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount_input",
				"type": "uint256"
			}
		],
		"name": "weixin",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "transaction_view",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
            const web3 = new Web3(Web3.givenProvider);
            const contract = new web3.eth.Contract(contractABI, contractAddress);
            async function Transfer(){
                const accounts = await web3.eth.requestAccounts();
                const payer = document.getElementById('payer').value;
                const payee = document.getElementById('payee').value;
                const amount= document.getElementById('amount').value;
                console.log(payer,payee,amount);
                console.log(accounts[0]);
                await contract.methods.weixin(payer, payee,amount).send({ from: accounts[0]});
            }

            async function View_Transaction() {
                const result = await contract.methods.transaction_view().call();
                console.log(result[0],result[1],result[2]);
                document.getElementById('view_payer').innerText = "Payer: " + result[0];
                document.getElementById('view_payee').innerText = "Payee: " + result[1];
                document.getElementById('view_amount').innerText = "Amount: " + result[2];
            }


        </script>
    </div>

</body>